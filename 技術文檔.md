# ProductShop 專案技術文檔

## 專案概述
這是一個基於 Spring Boot 的電商平台專案，主要功能包括用戶註冊、登入、密碼重置等用戶管理功能。

## 主要技術棧

### 後端技術
- **Spring Boot 3.5.4** (核心框架)
- **Java 21**
- **MySQL 8.0.22** (資料庫)
- **JWT** (身份驗證)
- **BCrypt** (密碼加密)
- **Spring Mail** (電子郵件服務)
- **Spring Validation** (資料驗證)
- **Spring AOP** (面向切面程式設計)
- **Spring JDBC** (資料庫連接)

### 前端技術
- **HTML5/CSS3/JavaScript**
- **Boxicons** (圖示庫)
- **響應式設計**
- **CSS Media Queries**
- **SVG** (向量圖形)

## 專案特色
- **完整的用戶管理系統** - 註冊、登入、密碼重置
- **安全性設計** - JWT認證、密碼加密、資料驗證
- **現代化UI** - 響應式設計、美觀的用戶介面
- **電子郵件功能** - 使用Gmail SMTP發送驗證郵件

## 實作功能列表

## 後端功能

### 用戶註冊後端功能
- ✅ **用戶資料接收** - 接收前端註冊表單資料
- ✅ **密碼加密存儲** - 使用BCrypt加密密碼
- ✅ **電子郵件驗證** - 註冊後自動發送驗證郵件
- ✅ **郵箱驗證處理** - 處理郵箱驗證連結點擊
- ✅ **重新發送驗證郵件** - 支援重新發送功能
- ✅ **帳號狀態管理** - 未驗證帳號無法登入

### 用戶登入後端功能
- ✅ **帳號驗證** - 檢查帳號是否存在
- ✅ **密碼驗證** - BCrypt密碼比對
- ✅ **帳號狀態檢查** - 只有active狀態帳號可登入
- ✅ **JWT Token發放** - 登入成功後發放24小時有效Token
- ✅ **登入回應處理** - 成功/失敗訊息回饋

### 密碼重置後端功能
- ✅ **密碼重置申請處理** - 處理密碼重置申請
- ✅ **重置郵件發送** - 自動發送密碼重置確認郵件
- ✅ **重置連結驗證** - 驗證重置連結有效性
- ✅ **密碼更新** - 更新資料庫中的密碼
- ✅ **一次性重置連結** - 重置後連結失效

### 安全性後端功能
- ✅ **JWT過濾器** - 請求攔截和Token驗證
- ✅ **白名單路徑** - 設定不需要驗證的API路徑
- ✅ **CORS配置** - 跨域請求支援
- ✅ **全局異常處理** - 統一的錯誤處理機制
- ✅ **後端資料驗證** - 服務端資料驗證

### API端點功能
- ✅ `POST /users/register` - 用戶註冊
- ✅ `GET /users/verify` - 郵箱驗證
- ✅ `POST /users/resend-verification` - 重新發送驗證郵件
- ✅ `POST /users/login` - 用戶登入
- ✅ `GET /secure/test` - 受保護的測試端點
- ✅ `POST /users/password/reset/request` - 申請密碼重置
- ✅ `GET /users/password/reset/confirm` - 確認密碼重置

### 電子郵件後端功能
- ✅ **Gmail SMTP整合** - 使用Gmail SMTP服務
- ✅ **STARTTLS加密** - 安全的郵件傳輸
- ✅ **會員驗證郵件** - 註冊驗證郵件模板
- ✅ **密碼重置郵件** - 密碼重置郵件模板
- ✅ **自動化發送** - 系統自動發送郵件

### 資料庫後端功能
- ✅ **會員資料管理** - 會員註冊資料存儲
- ✅ **會員狀態管理** - 帳號狀態追蹤
- ✅ **登入記錄追蹤** - 記錄最後登入時間
- ✅ **驗證Token管理** - 郵箱驗證和密碼重置Token
- ✅ **Token過期處理** - 自動清理過期Token

---

## 前端功能

### 用戶註冊前端功能
- ✅ **用戶註冊表單** - 包含姓名、電話、郵箱、密碼欄位
- ✅ **前端表單驗證** - 即時驗證用戶輸入資料
- ✅ **表單提交處理** - AJAX提交註冊資料
- ✅ **註冊回應處理** - 處理註冊成功/失敗訊息
- ✅ **重新發送驗證介面** - 重新發送驗證郵件按鈕

### 用戶登入前端功能
- ✅ **登入表單** - 郵箱和密碼登入
- ✅ **前端表單驗證** - 即時驗證登入資料
- ✅ **表單提交處理** - AJAX提交登入資料
- ✅ **登入回應處理** - 處理登入成功/失敗訊息
- ✅ **Token存儲管理** - 本地存儲JWT Token

### 密碼重置前端功能
- ✅ **密碼重置表單** - 輸入郵箱和新密碼
- ✅ **前端表單驗證** - 即時驗證重置資料
- ✅ **表單提交處理** - AJAX提交重置申請
- ✅ **重置回應處理** - 處理重置成功/失敗訊息

### 前端介面功能
- ✅ **響應式設計** - 支援桌面和行動裝置
- ✅ **表單切換動畫** - 登入/註冊表單平滑切換
- ✅ **即時表單驗證** - 輸入時即時驗證
- ✅ **成功/錯誤訊息** - 用戶友好的提示訊息
- ✅ **模態框對話框** - 密碼重置和重新發送驗證
- ✅ **載入狀態顯示** - 表單提交時顯示載入狀態
- ✅ **導航欄響應式** - 行動裝置選單切換

### 前端JavaScript功能
- ✅ **AJAX請求處理** - 處理API請求
- ✅ **回應資料處理** - 處理後端回應
- ✅ **錯誤處理機制** - 前端錯誤處理
- ✅ **表單驗證邏輯** - 前端驗證規則
- ✅ **動畫效果控制** - 控制UI動畫
- ✅ **本地存儲管理** - 管理Token和用戶資料

### 專案架構

#### 後端架構 (MVC 模式)
```
src/main/java/org/example/productshop/
├── api/                    # API 工具類
│   ├── BCrypt.java        # 密碼加密
│   └── JwtUtil.java       # JWT 工具
├── config/                 # 配置類
│   └── WebConfig.java     # Web 配置
├── controller/            # 控制器層
│   ├── ForgetPasswordController.java
│   ├── LoginController.java
│   └── RegisterController.java
├── dao/                   # 資料存取層
│   ├── ForgetPasswordDao.java
│   ├── LoginDao.java
│   ├── RegisterDao.java
│   ├── RegisterDaoImpel.java
│   └── VerifyEmailDao.java
├── entity/                # 實體類
│   └── Member.java        # 會員實體
├── exception/             # 異常處理
│   └── GlobalExceptionHandler.java
├── filter/                # 過濾器
│   └── JwtFilter.java     # JWT 過濾器
├── service/               # 服務層
│   ├── EmailService.java
│   ├── LoginService.java
│   ├── RegisterService.java
│   └── RegisterServiceImpel.java
└── ProductShopApplication.java  # 主應用程式
```

#### 前端架構
```
src/main/resources/static/
├── CSS/                   # 樣式檔案
│   ├── icon.css          # 圖示樣式
│   ├── queries.css       # 響應式查詢
│   └── style.css         # 主要樣式
├── JS/                    # JavaScript 檔案
│   └── index.js          # 主要腳本
├── img/                   # 圖片資源
│   └── appleOrchard.png
├── index.html            # 主頁面
├── login.html            # 登入頁面
├── register.html         # 註冊頁面
├── forget-password-test.html  # 密碼重置測試頁面
└── test.html             # 測試頁面
```

### 配置設定

#### 資料庫配置
- **資料庫**: MySQL
- **資料庫名稱**: product_shop
- **時區**: Asia/Taipei
- **編碼**: UTF-8

#### 郵件服務配置
- **SMTP 服務**: Gmail
- **端口**: 587
- **加密**: STARTTLS

#### JWT 配置
- **過期時間**: 24小時 (86400000毫秒)
- **密鑰**: 自定義密鑰

### 主要功能模組

#### 1. 用戶註冊系統
- **電子郵件驗證**
  - 註冊時發送驗證郵件
  - 點擊郵件連結完成帳號啟用
  - 支援重新發送驗證郵件功能
- **密碼加密存儲**
  - 使用 BCrypt 進行密碼加密
  - 安全的密碼存儲機制
- **資料驗證**
  - 前端表單驗證（姓名、電話、郵箱、密碼）
  - 後端資料驗證
  - 郵箱格式驗證

#### 2. 用戶登入系統
- **JWT 身份驗證**
  - 登入成功後發放 JWT Token
  - Token 有效期 24 小時
  - 安全的身份驗證機制
- **密碼驗證**
  - BCrypt 密碼比對
  - 帳號密碼錯誤處理
- **登入狀態管理**
  - 檢查帳號是否已註冊
  - 檢查帳號狀態是否為 active
  - 登入成功/失敗回應處理

#### 3. 密碼重置系統
- **密碼重置申請**
  - 輸入郵箱和新密碼
  - 發送重置確認郵件
- **密碼重置確認**
  - 點擊郵件連結確認重置
  - 更新資料庫中的密碼
- **安全性驗證**
  - Token 驗證機制
  - 一次性重置連結

#### 4. 前端用戶介面
- **響應式設計**
  - 支援桌面和行動裝置
  - CSS Media Queries 響應式佈局
  - Mobile-first 設計理念
- **現代化 UI**
  - 美觀的登入/註冊表單
  - 動畫效果和過渡
  - Boxicons 圖示庫
- **用戶友好的操作流程**
  - 表單切換動畫
  - 即時表單驗證
  - 成功/錯誤訊息提示
  - 模態框對話框

#### 5. 安全性功能
- **JWT 過濾器**
  - 請求攔截和驗證
  - 白名單路徑設定
  - 未授權請求處理
- **CORS 配置**
  - 跨域請求支援
  - 允許特定來源訪問
- **全局異常處理**
  - 統一的錯誤處理機制
  - 友好的錯誤訊息

#### 6. 電子郵件服務
- **Gmail SMTP 整合**
  - 使用 Gmail SMTP 服務
  - STARTTLS 加密
  - 自動化郵件發送
- **郵件模板**
  - 會員驗證郵件
  - 密碼重置郵件
  - 自定義郵件內容

#### 7. API 端點功能
- **註冊相關**
  - `POST /users/register` - 用戶註冊
  - `GET /users/verify` - 郵箱驗證
  - `POST /users/resend-verification` - 重新發送驗證郵件
- **登入相關**
  - `POST /users/login` - 用戶登入
  - `GET /secure/test` - 受保護的測試端點
- **密碼重置相關**
  - `POST /users/password/reset/request` - 申請密碼重置
  - `GET /users/password/reset/confirm` - 確認密碼重置

#### 8. 資料庫操作
- **會員資料管理**
  - 會員註冊資料存儲
  - 會員狀態管理
  - 登入記錄追蹤
- **驗證 Token 管理**
  - 郵箱驗證 Token 存儲
  - 密碼重置 Token 存儲
  - Token 過期處理

#### 9. 前端 JavaScript 功能
- **表單處理**
  - 動態表單切換
  - 即時欄位驗證
  - 表單提交處理
- **API 整合**
  - AJAX 請求處理
  - 回應資料處理
  - 錯誤處理機制
- **用戶體驗**
  - 載入狀態顯示
  - 成功/錯誤訊息
  - 模態框管理
  - 導航欄響應式功能

### 專案特色功能

#### 1. 完整的用戶生命週期管理
- **註冊 → 驗證 → 登入 → 密碼重置** 完整流程
- 每個階段都有相應的安全驗證機制
- 用戶友好的操作體驗

#### 2. 雙重安全驗證機制
- **郵箱驗證**：註冊時必須驗證郵箱才能啟用帳號
- **JWT Token**：登入後使用 Token 進行身份驗證
- **密碼加密**：使用 BCrypt 確保密碼安全

#### 3. 智能錯誤處理
- 前端即時表單驗證
- 後端統一的錯誤回應格式
- 用戶友好的錯誤訊息提示

#### 4. 響應式設計
- 支援各種螢幕尺寸
- 行動裝置優先的設計理念
- 流暢的動畫效果

#### 5. 自動化郵件服務
- 註冊驗證郵件自動發送
- 密碼重置郵件自動發送
- 支援重新發送功能

#### 6. 開發者友好
- 清晰的程式碼架構
- 完整的 API 文檔
- 易於擴展和維護

### 開發環境要求

- **JDK**: 21 或以上
- **Maven**: 3.6 或以上
- **MySQL**: 8.0 或以上
- **IDE**: IntelliJ IDEA, Eclipse, VS Code 等

### 部署說明

1. 確保 MySQL 資料庫已啟動並創建 `product_shop` 資料庫
2. 修改 `application.properties` 中的資料庫連接資訊
3. 配置 Gmail SMTP 設定
4. 執行 `mvn spring-boot:run` 啟動應用程式
5. 訪問 `http://localhost:8080` 查看應用程式

### 安全性考量

- 使用 BCrypt 進行密碼加密
- JWT 用於身份驗證
- 輸入資料驗證
- 全局異常處理
- CORS 配置

### 測試

- 使用 Spring Boot Test 進行單元測試
- 提供測試頁面進行功能驗證
- 包含密碼重置測試頁面

---

*此文檔記錄了 ProductShop 專案使用的所有技術和框架，可作為開發和維護的參考資料。*
